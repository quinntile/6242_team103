var full_width=820,full_height=400,margin={top:10,right:10,bottom:0,left:10},width=full_width-margin.left-margin.right,height=full_height-margin.top-margin.bottom,seattle_svg=d3.select("#seattle").append("svg").attr("width",full_width).attr("height",full_height),seattle_colors=["#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],seattle_color_scale=d3.scaleQuantile().range(seattle_colors),austin_svg=d3.select("#austin").append("svg").attr("width",full_width).attr("height",full_height),austin_colors=["#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],austin_color_scale=d3.scaleQuantile().range(austin_colors),radius_scale=d3.scaleLinear().range([3,6]),boundary_json_promise=d3.json("data_source/area_county_boundary_way_node_coords.json"),seattle_zipcode_coords_promise=d3.csv("data_source/seattle_zipcode_coords.csv",function(e){return{zip:Number(e.ZipCode),lat:Number(e.lat),lon:Number(e.lon)}}),seattle_prices_promise=d3.csv("data_source/Seattle_price.csv",function(e){var a=Number(e.unemployment);return a<0&&(a=0),median_income=Math.round(Number(e.median_income)),median_income<=0?median_income="N/A":median_income=`$${median_income}`,{zip:Number(e.ZipCode),median_income:median_income,year_built:Number(e.YrBuilt),unemployment:(100*a).toFixed(2)+"%",label:Math.round(Number(e.Label))}}),austin_zipcode_coords_promise=d3.csv("data_source/austin_zipcode_coords.csv",function(e){return{zip:Number(e.ZipCode),lat:Number(e.lat),lon:Number(e.lon)}}),austin_prices_promise=d3.csv("data_source/Austin_price.csv",function(e){var a=Number(e.Unemployment);return a<0&&(a=0),median_income=Math.round(Number(e.median_income)),median_income<=0?median_income="N/A":median_income=`$${median_income}`,{zip:Number(e.ZipCode),median_income:median_income,property_type:e.property_type,unemployment:(100*a).toFixed(2)+"%",label:Math.round(Number(e.Label))}});function draw_base_map_and_scale(e,a){var t=d3.scaleLinear().range([0,width]),i=d3.scaleLinear().range([height,0]),l=d3.line().x(e=>t(Number(e[1]))).y(e=>i(Number(e[0]))).curve(d3.curveLinear);min_x=d3.min(Array.from(a.values()),e=>d3.min(e,e=>d3.min(e,e=>Number(e[1])))),max_x=d3.max(Array.from(a.values()),e=>d3.max(e,e=>d3.max(e,e=>Number(e[1])))),min_y=d3.min(Array.from(a.values()),e=>d3.min(e,e=>d3.min(e,e=>Number(e[0])))),max_y=d3.max(Array.from(a.values()),e=>d3.max(e,e=>d3.max(e,e=>Number(e[0])))),x_span=max_x-min_x,x_granule=width/x_span,y_span=max_y-min_y,y_granule=height/y_span,granule=Math.min(x_granule,y_granule),x_domain_min=(min_x+max_x)/2-full_width/2/granule,x_domain_max=(min_x+max_x)/2+full_width/2/granule,y_domain_min=(min_y+max_y)/2-full_height/2/granule,y_domain_max=(min_y+max_y)/2+full_height/2/granule,t.domain([x_domain_min,x_domain_max]),i.domain([y_domain_min,y_domain_max]);var n=e.append("g").attr("class","base-map");for(let e of Array.from(a.keys())){var r=n.append("g").attr("class","county-layer").attr("id",e),o=a.get(e);for(let e of o)way_array=Object.values(e),r.append("path").attr("class","boundary-line").attr("d",function(e){return l(way_array)})}return[t,i]}function draw_zip_map(e,a,t,i){x=a[0],y=a[1],e.append("g").attr("class","zip-pin-group").selectAll("circle").data(t).enter().append("circle").attr("id",e=>"zip_"+e.zip).attr("fill","blue").attr("cx",e=>x(e.lon)).attr("cy",e=>y(e.lat)).attr("r",4).on("mouseover",function(e){var a=d3.event.x,t=d3.event.y;console.log(e),i.show(e),i.style("top",t+5+"px"),i.style("left",a+10+"px")}).on("mouseout",i.hide)}function rewrite_pins(e,a,t){t.clear(),seattle_year_built=d3.select("#seattle_dropdown").property("value"),austin_property_type=d3.select("#austin_dropdown").property("value"),console.log(`Option ${seattle_year_built}, ${austin_property_type} selected at ${Date.now()}`),seattle_selected_prices=e.filter(e=>e.year_built==seattle_year_built),seattle_labels=seattle_selected_prices.map(e=>e.label),seattle_color_scale.domain(seattle_labels),austin_selected_prices=a.filter(e=>e.property_type==austin_property_type),austin_labels=austin_selected_prices.map(e=>e.label),austin_color_scale.domain(austin_labels),all_labels=seattle_labels.concat(austin_labels),min_label=d3.min(all_labels),max_label=d3.max(all_labels),radius_scale.domain([min_label,max_label]);for(let e of seattle_selected_prices)t.set(e.zip,e),d3.select(`#zip_${e.zip}`).attr("fill",seattle_color_scale(e.label)).attr("r",radius_scale(e.label));for(let e of austin_selected_prices)t.set(e.zip,e),d3.select(`#zip_${e.zip}`).attr("fill",austin_color_scale(e.label)).attr("r",radius_scale(e.label));console.log(`Internal data update completed at ${Date.now()}`)}Promise.all([boundary_json_promise,seattle_zipcode_coords_promise,seattle_prices_promise,austin_zipcode_coords_promise,austin_prices_promise]).then(function(e){var a=new Map(Object.entries(e[0].Seattle)),t=new Map(Object.entries(e[0].Austin)),i=e[1],l=e[2],n=e[3],r=e[4];seattle_scale=draw_base_map_and_scale(seattle_svg,a),austin_scale=draw_base_map_and_scale(austin_svg,t),tool_tip=d3.tip().attr("class","pin-tip").attr("id","tool-tip"),seattle_svg.call(tool_tip),seattle_zip_pin_map=draw_zip_map(seattle_svg,seattle_scale,i,tool_tip),austin_zip_pin_map=draw_zip_map(austin_svg,austin_scale,n,tool_tip);var o=new Map;tool_tip.html(function(e){return zipcode=e.zip,o.has(zipcode)?(tip_info=o.get(zipcode),'<div class="tip-window">'+`<p>Zip Code: ${zipcode}</p>`+`<p>House Price: $${tip_info.label}</p>`+`<p>Predicted Median Income (2022): ${tip_info.median_income}</p>`+`<p>Predicted Unemployment (2022): ${tip_info.unemployment}</p>`+"</div>"):'<div class="tip-window">'+`<p>Zip Code: ${zipcode}</p>`+'<p style="color:red">Data is missing.</p></div>'});var _=Array(43).fill().map((e,a)=>a+1980);d3.select("#seattle_dropdown").selectAll("option").data(_).enter().append("option").text(e=>e).attr("value",e=>e),d3.select("#seattle_dropdown").on("change",function(){rewrite_pins(l,r,o)});d3.select("#austin_dropdown").selectAll("option").data(["All Residential","Condo/Co-op","Multi-Family (2-4 Unit)","Single Family Residential","Townhouse"]).enter().append("option").text(e=>e).attr("value",e=>e),d3.select("#austin_dropdown").on("change",function(){rewrite_pins(l,r,o)}),rewrite_pins(l,r,o)});